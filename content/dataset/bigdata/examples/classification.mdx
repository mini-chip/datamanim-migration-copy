# 예제문제 2 - 분류

## 문제 설명

고객의 특성을 바탕으로 제품 구매 여부를 예측하는 이진 분류 모델을 구축하시오.

### 데이터 정보
- **독립변수**: 나이(age), 소득(income), 이전구매횟수(previous_purchases)
- **종속변수**: 구매여부(purchased) - 0: 미구매, 1: 구매
- **목표**: 로지스틱 회귀를 이용한 구매 예측 모델 구축

## 데이터 준비

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.linear_model import LogisticRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score
from sklearn.metrics import confusion_matrix, classification_report, roc_auc_score
from sklearn.preprocessing import StandardScaler

# 샘플 데이터 생성
np.random.seed(42)
n_samples = 200

age = np.random.normal(35, 10, n_samples)
income = np.random.normal(50000, 15000, n_samples)
previous_purchases = np.random.poisson(3, n_samples)

# 구매 확률을 나이, 소득, 이전구매횟수에 따라 결정
purchase_prob = (
    0.1 +
    0.01 * (age - 20) +
    0.000015 * (income - 30000) +
    0.1 * previous_purchases
)
purchased = np.random.binomial(1, np.clip(purchase_prob, 0, 1), n_samples)

df = pd.DataFrame({
    'age': age,
    'income': income,
    'previous_purchases': previous_purchases,
    'purchased': purchased
})

print("데이터 확인:")
print(df.head())
print(f"\n데이터 크기: {df.shape}")
print(f"구매율: {df['purchased'].mean():.3f}")
```

```
데이터 확인:
        age        income  previous_purchases  purchased
0  39.967142  59865.628020                   4          1
1  35.617357  45986.968646                   3          1
2  44.640732  63009.369413                   2          1
3  42.204344  56841.457380                   1          0
4  34.864279  47484.575033                   5          1

데이터 크기: (200, 4)
구매율: 0.635
```

## 문제 1: 탐색적 데이터 분석

**Q1-1.** 구매 여부에 따른 각 변수의 분포를 확인하시오.

<CollapsibleCodeCell code={`plt.show()`} />

**Q1-2.** 변수들 간의 상관관계를 분석하시오.

<CollapsibleCodeCell code={`plt.show()`} />

## 문제 2: 데이터 전처리 및 분할

**Q2-1.** 독립변수를 표준화하고 훈련/테스트 데이터로 분할하시오.

<CollapsibleCodeCell code={`print(f"테스트 데이터 구매율: {y_test.mean():.3f}")`} />

## 문제 3: 로지스틱 회귀 모델 구축

**Q3-1.** 로지스틱 회귀 모델을 학습시키고 회귀계수를 확인하시오.

<CollapsibleCodeCell code={`plt.show()`} />

## 문제 4: 모델 예측 및 평가

**Q4-1.** 테스트 데이터에 대한 예측을 수행하고 분류 성능을 평가하시오.

<CollapsibleCodeCell code={`print(classification_report(y_test, y_pred, target_names=['미구매', '구매']))`} />

**Q4-2.** 혼동행렬을 생성하고 시각화하시오.

<CollapsibleCodeCell code={`print(f"True Positive (올바른 구매 예측): {tp}")`} />

## 문제 5: ROC 곡선 및 임계값 분석

**Q5-1.** ROC 곡선을 그리고 최적 임계값을 찾으시오.

<CollapsibleCodeCell code={`print(f"최적 임계값에서의 F1-점수: {max(f1_scores):.3f}")`} />

## 문제 6: 새로운 고객 예측

**Q6-1.** 새로운 고객의 구매 확률을 예측하시오.

<CollapsibleCodeCell code={`print(f"고객 {i+1}: 구매 확률 {prob:.3f}, 예측 결과: {'구매' if pred == 1 else '미구매'}")`} />

## 문제 7: 특성 중요도 분석

**Q7-1.** 각 특성이 구매 결정에 미치는 영향을 분석하시오.

<CollapsibleCodeCell code={`plt.show()`} />

## 종합 정리

:::note[학습 요약]
이 예제에서 다룬 주요 내용:

1. **데이터 탐색**: 분포 분석, 상관관계 분석
2. **전처리**: 표준화, 데이터 분할
3. **모델 구축**: 로지스틱 회귀 학습
4. **성능 평가**: Accuracy, Precision, Recall, F1-score, AUC
5. **시각화**: 혼동행렬, ROC 곡선
6. **해석**: 특성 중요도, 회귀계수 해석
:::

:::warning[평가지표 해석]
- **정확도**: 전체 예측 중 올바른 예측의 비율
- **정밀도**: 구매 예측 중 실제 구매한 비율
- **재현율**: 실제 구매자 중 올바르게 예측한 비율
- **F1-점수**: 정밀도와 재현율의 조화평균
- **AUC**: ROC 곡선 하단 면적 (0.5~1.0, 높을수록 좋음)
:::

## 참고자료

- scikit-learn Logistic Regression 문서
- 『패턴 인식과 머신러닝』, Christopher Bishop
- 『The Elements of Statistical Learning』, Hastie et al.