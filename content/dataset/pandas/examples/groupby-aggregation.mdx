# Pandas 예제문제 2 - GroupBy와 집계

## 문제 설명

GroupBy 연산을 활용하여 데이터를 그룹별로 집계하고 분석하는 방법을 학습하시오.

## 데이터 준비

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# 판매 데이터 생성
np.random.seed(42)
n = 500

# 제품 카테고리와 지역 정의
categories = ['전자제품', '의류', '식품', '가구', '도서']
regions = ['서울', '부산', '대구', '인천', '광주']
sales_reps = [f'영업사원{i+1}' for i in range(20)]

data = {
    'order_date': pd.date_range('2023-01-01', periods=n, freq='D')[:n],
    'category': np.random.choice(categories, n),
    'region': np.random.choice(regions, n),
    'sales_rep': np.random.choice(sales_reps, n),
    'quantity': np.random.randint(1, 100, n),
    'unit_price': np.random.uniform(10, 1000, n).round(2),
    'customer_type': np.random.choice(['신규', '기존'], n, p=[0.3, 0.7])
}

# 총 매출액 계산
data['total_sales'] = data['quantity'] * data['unit_price']

df = pd.DataFrame(data)
df['month'] = df['order_date'].dt.month
df['quarter'] = df['order_date'].dt.quarter

print("데이터 기본정보:")
print(df.head())
print(f"\n데이터 크기: {df.shape}")
print(f"\n컬럼 정보:")
print(df.dtypes)
```

## 문제 1: 기본 GroupBy 연산

**Q1-1.** 카테고리별 총 매출액과 평균 매출액을 계산하시오.

<CollapsibleCodeCell code={`print(category_stats[['총매출액', '매출비중(%)']])`} />

**Q1-2.** 지역별 매출 현황을 분석하시오.

<CollapsibleCodeCell code={`plt.show()`} />

## 문제 2: 다중 그룹화

**Q2-1.** 카테고리별, 지역별 매출을 동시에 분석하시오.

<CollapsibleCodeCell code={`print(f"{category}: {region} ({sales:,.0f}원)")`} />

## 문제 3: 시간별 집계

**Q3-1.** 월별, 분기별 매출 추이를 분석하시오.

<CollapsibleCodeCell code={`print(monthly_sales[['총매출액', '전월대비성장률(%)']].round(1))`} />

## 문제 4: 커스텀 집계 함수

**Q4-1.** 사용자 정의 함수를 사용하여 고급 집계를 수행하시오.

<CollapsibleCodeCell code={`plt.show()`} />

## 문제 5: 조건부 집계

**Q5-1.** 조건에 따른 집계를 수행하시오.

<CollapsibleCodeCell code={`plt.show()`} />

## 문제 6: transform()과 apply() 활용

**Q6-1.** transform()과 apply()를 사용하여 그룹 내 변환을 수행하시오.

<CollapsibleCodeCell code={`plt.show()`} />

## 종합 정리

:::note[학습 요약]
이 예제에서 다룬 주요 내용:

1. **기본 GroupBy**: 단일/다중 컬럼으로 그룹화
2. **집계 함수**: sum(), mean(), count(), agg() 활용
3. **다중 그룹화**: 여러 컬럼으로 동시 그룹화
4. **시간별 집계**: 날짜/시간 데이터 그룹화
5. **커스텀 함수**: 사용자 정의 집계 함수 작성
6. **조건부 집계**: 조건에 따른 선택적 집계
7. **transform()**: 그룹별 변환 및 표준화
8. **apply()**: 복잡한 그룹별 분석 함수 적용
:::

:::warning[GroupBy 주의사항]
- **메모리 사용량**: 대용량 데이터에서 그룹화 시 메모리 고려
- **인덱스 처리**: 그룹화 결과의 인덱스 구조 이해 필요
- **NaN 처리**: 결측값이 그룹화에 미치는 영향 고려
- **성능 최적화**: 적절한 집계 함수 선택으로 성능 향상
:::

## 참고자료

- Pandas 공식 문서 - Group By
- 『파이썬 라이브러리를 활용한 데이터 분석』, 웨스 맥키니
- 『Effective Pandas』, Matt Harrison